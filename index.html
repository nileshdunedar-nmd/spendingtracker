<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spending Tracker</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase v10 compat (namespaced API support) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-dark: #0F172A;
            --primary: #0A4174;
            --primary-light: #1E90FF;
            --accent: #6EA2B3;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --gray-800: #1F2937;
            --gray-700: #374151;
            --gray-600: #4B5563;
            --gray-300: #D1D5DB;
            --glass-light: rgba(255,255,255,0.1);
            --glass-dark: rgba(0,0,0,0.3);
        }

        body {
            background: linear-gradient(135deg, #0F172A 0%, #1a1f3a 50%, #0F172A 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #E5E7EB;
            overflow-x: hidden;
            padding-bottom: 80px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        body.light-mode {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 50%, #F8F9FA 100%);
            color: #1F2937;
        }

        /* ===== GLASS MORPHISM ===== */
        .glass {
            background: rgba(20, 33, 61, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            box-shadow: 
                0 8px 32px 0 rgba(31, 38, 135, 0.37),
                inset 0 0 32px rgba(255,255,255,0.1);
        }

        .glass-card {
            background: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
        }

        body.light-mode .glass-card {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(30, 144, 255, 0.2);
            box-shadow: 0 8px 32px rgba(30, 144, 255, 0.1);
        }

        /* ===== CONTAINER ===== */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: 100px;
        }

        /* ===== AUTH SCREEN ===== */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0F172A 0%, #1a1f3a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-card {
            text-align: center;
            width: 90%;
            max-width: 400px;
        }

        .auth-logo {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #1E90FF, #0A4174);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        .auth-card h1 {
            font-size: 28px;
            margin-bottom: 8px;
            color: white;
        }

        .auth-card p {
            color: #9CA3AF;
            margin-bottom: 24px;
        }

        .auth-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            color: white;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .auth-input::placeholder { color: rgba(255,255,255,0.5); }
        .auth-input:focus { outline: none; border-color: #1E90FF; }

        .auth-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #1E90FF, #0A4174);
            background-clip: padding-box;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            box-shadow: 0 8px 24px rgba(30, 144, 255, 0.3);
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(30, 144, 255, 0.4);
        }

        .auth-toggle {
            margin-top: 16px;
            color: #9CA3AF;
        }

        .auth-toggle a {
            color: #1E90FF;
            cursor: pointer;
            text-decoration: none;
        }

        .hidden { display: none !important; }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, rgba(10, 65, 116, 0.3), rgba(15, 23, 42, 0.5));
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 16px;
            border-radius: 0 0 20px 20px;
            margin-bottom: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #1E90FF, #0A4174);
            background-clip: padding-box;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(30, 144, 255, 0.3);
        }

        .header-text h2 {
            font-size: 18px;
            color: white;
            margin: 0;
        }

        .header-text p {
            font-size: 12px;
            color: #9CA3AF;
            margin: 0;
        }

        .header-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* ===== DASHBOARD ALERT ===== */
        .alert {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.1));
            border-left: 4px solid #10B981;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .alert-icon {
            font-size: 20px;
        }

        .alert-text {
            flex: 1;
        }

        .alert-text h4 {
            margin: 0;
            font-size: 13px;
            color: #10B981;
        }

        .alert-text p {
            margin: 4px 0 0;
            font-size: 12px;
            color: #9CA3AF;
        }

        /* ===== STATS GRID ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(30, 144, 255, 0.15), rgba(10, 65, 116, 0.15));
            border: 1px solid rgba(30, 144, 255, 0.3);
            border-radius: 16px;
            padding: 16px;
            box-shadow: inset 0 0 20px rgba(30, 144, 255, 0.1);
        }

        .stat-label {
            font-size: 12px;
            color: #6EA2B3;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 11px;
            color: #9CA3AF;
        }

        .stat-change.positive { color: #10B981; }
        .stat-change.negative { color: #EF4444; }

        /* ===== PROGRESS BAR ===== */
        .progress-section {
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-label {
            font-size: 13px;
            font-weight: 600;
            color: white;
        }

        .progress-percent {
            font-size: 13px;
            color: #6EA2B3;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1E90FF, #0A4174);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(30, 144, 255, 0.5);
        }

        /* ===== CHARTS ===== */
        .chart-container {
            position: relative;
            height: 250px;
            margin-bottom: 16px;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: white;
        }

        /* ===== TABS (BOTTOM) ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95));
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 200;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: #6B7280;
            cursor: pointer;
            padding: 8px 12px;
            transition: all 0.2s;
            font-size: 20px;
        }

        .nav-btn.active {
            color: #1E90FF;
            transform: scale(1.1);
        }

        .nav-label {
            font-size: 10px;
            font-weight: 600;
        }

        /* ===== CONTENT SECTIONS ===== */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ===== TRANSACTION FORM ===== */
        .form-group {
            margin-bottom: 14px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            color: white;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            color: white;
            font-size: 13px;
            transition: all 0.2s;
        }

        .form-input::placeholder { color: rgba(255,255,255,0.5); }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #1E90FF;
            box-shadow: 0 0 12px rgba(30, 144, 255, 0.3);
        }

        body.light-mode .form-input,
        body.light-mode .form-select {
            background: rgba(30, 144, 255, 0.05);
            border-color: rgba(30, 144, 255, 0.2);
            color: #1F2937;
        }

        body.light-mode .form-input::placeholder {
            color: rgba(31, 41, 55, 0.5);
        }

        body.light-mode .form-input:focus,
        body.light-mode .form-select:focus {
            border-color: #1E90FF;
            box-shadow: 0 0 12px rgba(30, 144, 255, 0.2);
        }

        .type-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 14px;
        }

        .type-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            color: #9CA3AF;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .type-btn.active {
            background: linear-gradient(135deg, #1E90FF, #0A4174);
            border-color: #1E90FF;
            color: white;
        }

        .btn-add {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #1E90FF, #0A4174);
            background-clip: padding-box;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(30, 144, 255, 0.3);
            transition: all 0.2s;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(30, 144, 255, 0.4);
        }

        /* ===== TRANSACTION LIST ===== */
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 8px;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.2s;
        }

        .transaction-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .transaction-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .transaction-icon {
            width: 36px;
            height: 36px;
            background: rgba(30, 144, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .transaction-info h4 {
            font-size: 13px;
            margin: 0;
            color: white;
        }

        .transaction-info p {
            font-size: 11px;
            margin: 2px 0 0;
            color: #9CA3AF;
        }

        .transaction-amount {
            text-align: right;
        }

        .transaction-amount .amount {
            font-size: 14px;
            font-weight: 700;
            color: white;
        }

        .amount.positive { color: #10B981; }
        .amount.negative { color: #EF4444; }

        /* ===== SEARCH ===== */
        .search-box {
            position: relative;
            margin-bottom: 16px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px 10px 36px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            color: white;
            font-size: 13px;
        }

        .search-box input::placeholder { color: rgba(255,255,255,0.5); }
        .search-box::before {
            content: 'üîç';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* ===== SETTINGS ===== */
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 8px;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s ease;
        }

        .settings-item-left h4 {
            font-size: 13px;
            margin: 0;
            color: white;
        }

        .settings-item-left p {
            font-size: 11px;
            margin: 4px 0 0;
            color: #9CA3AF;
        }

        body.light-mode .settings-item {
            background: rgba(30, 144, 255, 0.05);
            border-color: rgba(30, 144, 255, 0.2);
        }

        body.light-mode .settings-item-left h4 {
            color: #1F2937;
        }

        body.light-mode .settings-item-left p {
            color: #6B7280;
        }

        .settings-toggle {
            width: 48px;
            height: 28px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-toggle.on {
            background: #10B981;
        }

        body.light-mode .settings-toggle {
            background: rgba(30, 144, 255, 0.1);
        }

        body.light-mode .settings-toggle.on {
            background: #10B981;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 480px) {
            .header { padding: 12px; }
            .container { padding: 12px; }
            .stats-grid { gap: 10px; }
            .stat-card { padding: 12px; }
            .stat-value { font-size: 20px; }
        }



        /* Green-Blue Glass Morphism - replace/override previous glass styles */
.glass {
    background: linear-gradient(180deg, rgba(6, 30, 48, 0.45), rgba(3, 53, 78, 0.35));
    backdrop-filter: blur(12px) saturate(1.05);
    -webkit-backdrop-filter: blur(12px) saturate(1.05);
    border: 1px solid rgba(60, 192, 255, 0.10);
    border-radius: 16px;
    box-shadow:
        0 8px 30px rgba(3, 45, 70, 0.40),
        0 0 40px rgba(40, 200, 255, 0.03) inset;
    color: #E6F9FF;
}

/* Cards with stronger green-blue tint */
.glass-card {
    background: linear-gradient(135deg, rgba(8, 96, 140, 0.26), rgba(2, 34, 58, 0.28));
    backdrop-filter: blur(14px) saturate(1.05);
    -webkit-backdrop-filter: blur(14px) saturate(1.05);
    border: 1px solid rgba(46, 195, 255, 0.12);
    border-radius: 18px;
    padding: 18px;
    margin-bottom: 14px;
    box-shadow:
        0 10px 40px rgba(2, 40, 60, 0.45),
        inset 0 1px 0 rgba(255,255,255,0.02);
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    color: #E6F9FF;
}
.glass-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 18px 50px rgba(5, 80, 120, 0.45), 0 0 40px rgba(46,195,255,0.06) inset;
}

/* Stat cards - subtle glass + neon accent */
.stat-card {
    background: linear-gradient(180deg, rgba(10, 56, 86, 0.22), rgba(4, 28, 46, 0.28));
    border: 1px solid rgba(46,195,255,0.10);
    border-radius: 14px;
    padding: 16px;
    box-shadow: inset 0 2px 20px rgba(46,195,255,0.02);
    transition: transform 0.18s;
}
.stat-card:hover { transform: translateY(-4px); }

/* Transaction items */
.transaction-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: linear-gradient(180deg, rgba(4,38,58,0.30), rgba(6,60,90,0.20));
    border-radius: 12px;
    margin-bottom: 10px;
    border: 1px solid rgba(46,195,255,0.06);
    box-shadow: 0 6px 20px rgba(3,35,50,0.35);
    transition: background 0.18s, transform 0.18s;
}
.transaction-item:hover {
    background: linear-gradient(180deg, rgba(6,60,90,0.36), rgba(10,90,130,0.22));
    transform: translateY(-3px);
}

/* Transaction icon accent */
.transaction-icon {
    background: linear-gradient(135deg, rgba(34, 183, 255, 0.12), rgba(12, 102, 140, 0.20));
    border: 1px solid rgba(46,195,255,0.08);
    color: #DFF8FF;
}

/* Settings items */
.settings-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px;
    background: linear-gradient(180deg, rgba(6, 40, 62, 0.30), rgba(10, 70, 100, 0.20));
    border-radius: 12px;
    margin-bottom: 10px;
    border: 1px solid rgba(46,195,255,0.07);
    box-shadow: 0 6px 20px rgba(2,34,50,0.30);
}

/* Header glass look */
.header {
    background: linear-gradient(180deg, rgba(6, 36, 56, 0.6), rgba(8, 60, 86, 0.45));
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(46,195,255,0.08);
    padding: 16px;
    border-radius: 0 0 20px 20px;
    margin-bottom: 16px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 6px 24px rgba(2, 28, 44, 0.45);
}

/* Auth card */
.auth-card {
    background: linear-gradient(135deg, rgba(6, 50, 76, 0.55), rgba(4, 30, 46, 0.42));
    border: 1px solid rgba(46,195,255,0.10);
    padding: 24px;
    border-radius: 18px;
    box-shadow: 0 18px 50px rgba(3, 45, 70, 0.55);
    color: #E6F9FF;
}

/* Buttons - green/blue gradient */
.auth-btn,
.btn-add {
    background: linear-gradient(135deg, #1e90ff, #10b981);
    color: #fff;
    border: none;
    box-shadow: 0 10px 28px rgba(16,185,129,0.12);
    transition: transform 0.18s, box-shadow 0.18s;
}
.auth-btn:hover,
.btn-add:hover {
    transform: translateY(-3px);
    box-shadow: 0 16px 40px rgba(16,185,129,0.16);
}

/* Bottom nav glass */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(180deg, rgba(3, 34, 52, 0.9), rgba(2,26,40,0.95));
    backdrop-filter: blur(12px);
    border-top: 1px solid rgba(46,195,255,0.06);
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    z-index: 200;
}

/* Light mode adjustments */
body.light-mode .glass,
body.light-mode .glass-card,
body.light-mode .stat-card,
body.light-mode .transaction-item,
body.light-mode .settings-item {
    background: linear-gradient(180deg, rgba(235, 249, 255, 0.65), rgba(220, 245, 255, 0.60));
    color: #043044;
    border: 1px solid rgba(30, 144, 255, 0.12);
    box-shadow: 0 8px 30px rgba(30,144,255,0.06);
}

/* small polish */
.chart-title, .progress-label, .form-label, .stat-label { color: #DFF8FF; }
body.light-mode .chart-title, body.light-mode .progress-label, body.light-mode .form-label, body.light-mode .stat-label { color: #043044; }
    </style>
</head>
<body>

<!-- ===== AUTH SCREEN ===== -->
<div id="authScreen" class="auth-screen">
    <div class="auth-card">
        <div class="auth-logo">üí∞</div>
        <h1 id="authTitle">Login</h1>
        <p>Track your spending smartly</p>
        
        <input type="email" class="auth-input" id="authEmail" placeholder="Email address">
        <input type="password" class="auth-input" id="authPassword" placeholder="Password">
        <input type="password" class="auth-input hidden" id="authConfirmPassword" placeholder="Confirm password">
        
        <button class="auth-btn" onclick="handleAuth()">Login</button>
        
        <div class="auth-toggle">
            <span id="toggleText">Don't have account? </span>
            <a onclick="toggleAuthMode()">Sign up</a>
        </div>
    </div>
</div>

<!-- ===== APP ===== -->
<div id="app" class="hidden">
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="header-icon">üí≥</div>
                <div class="header-text">
                    <h2>Spending Tracker</h2>
                    <p id="headerDate"></p>
                </div>
            </div>
            <button class="header-btn" onclick="logout()">üë§</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- ===== DASHBOARD PAGE ===== -->
        <div id="dashboardPage" class="page active">
            <!-- Alert -->
            <div class="alert">
                <div class="alert-icon">‚úÖ</div>
                <div class="alert-text">
                    <h4>Budget Alert</h4>
                    <p id="alertText">You're spending well! Keep it up.</p>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Balance</div>
                    <div class="stat-value" id="totalBalance">‚Çπ0</div>
                    <div class="stat-change" id="balanceChange">+5% this month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">This Month</div>
                    <div class="stat-value" id="monthlyExpense">‚Çπ0</div>
                    <div class="stat-change negative" id="expenseChange">-‚Çπ500</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Income</div>
                    <div class="stat-value" id="totalIncome">‚Çπ0</div>
                    <div class="stat-change positive">+2 transactions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Budget Left</div>
                    <div class="stat-value" id="budgetLeft">‚Çπ0</div>
                    <div class="stat-change" id="budgetPercent">45% remaining</div>
                </div>
            </div>

            <!-- Monthly Budget Progress -->
            <div class="progress-section glass-card">
                <div class="progress-header">
                    <div class="progress-label">Monthly Budget</div>
                    <div class="progress-percent" id="budgetPercent2">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="budgetBar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Monthly Expense Graph -->
            <div class="glass-card">
                <div class="chart-title">üìä Monthly Expense</div>
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>

            <!-- Category Budget Progress -->
            <div class="glass-card">
                <div class="chart-title">üìà Category Distribution</div>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="glass-card">
                <div class="chart-title">üïê Recent Transactions</div>
                <div id="recentTransactions"></div>
            </div>
        </div>

        <!-- ===== ADD TRANSACTION PAGE ===== -->
        <div id="addPage" class="page">
            <div class="glass-card">
                <h3 style="color:white;margin-bottom:16px;">Add Transaction</h3>
                
                <div class="type-toggle">
                    <button class="type-btn active" onclick="setType('expense')" data-type="expense">Expense</button>
                    <button class="type-btn" onclick="setType('income')" data-type="income">Income</button>
                </div>

                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="category">
                        <option value="">Select Category</option>
                        <optgroup label="Expenses">
                            <option value="food">üçî Food & Dining</option>
                            <option value="groceries">üõí Groceries</option>
                            <option value="transport">üöó Transport</option>
                            <option value="clothing">üëï Clothing</option>
                            <option value="debt">üí≥ Debt</option>
                            <option value="savings">üè¶ Savings</option>
                            <option value="shopping">üõçÔ∏è Shopping</option>
                            <option value="utilities">üí° Utilities</option>
                            <option value="health">üè• Health & Medical</option>
                            <option value="travel">‚úàÔ∏è Travel</option>
                            <option value="housing">üè† Housing</option>
                            <option value="entertainment">üé¨ Entertainment</option>
                            <option value="education">üìö Education</option>
                            <option value="other">üì¶ Other</option>
                        </optgroup>
                        <optgroup label="Income">
                            <option value="salary">üíº Salary</option>
                            <option value="freelance">üíª Freelance</option>
                            <option value="investment">üìà Investment</option>
                            <option value="bonus">üéÅ Bonus</option>
                            <option value="other-income">üí∞ Other Income</option>
                        </optgroup>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" class="form-input" id="amount" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="transDate">
                </div>

                <div class="form-group">
                    <label class="form-label">Note</label>
                    <input type="text" class="form-input" id="note" placeholder="Add a note...">
                </div>

                <div class="form-group">
                    <label class="form-label">Tags (comma separated)</label>
                    <input type="text" class="form-input" id="tags" placeholder="e.g., work, urgent, recurring">
                </div>

                <button class="btn-add" onclick="addTransaction()">Add Transaction</button>
                <button class="btn-add" style="background: linear-gradient(135deg, #6EA2B3, #4E8EA2); margin-top: 8px;" onclick="resetAddForm()">Clear</button>
            </div>

            <div class="glass-card" style="margin-top:20px;">
                <h3 style="color:white;margin-bottom:16px;">üìã Quick Stats</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 12px; color: #9CA3AF; margin-bottom: 4px;">Total Added</div>
                        <div style="font-size: 20px; font-weight: 700; color: #10B981;" id="totalAddedToday">0</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 12px; color: #9CA3AF; margin-bottom: 4px;">Transactions</div>
                        <div style="font-size: 20px; font-weight: 700; color: #1E90FF;" id="transactionCount">0</div>
                    </div>
                </div>
                <h3 style="color:white;margin-bottom:16px;margin-top:20px;">Last 5 Transactions</h3>
                <div id="lastTransactions"></div>
            </div>
        </div>

        <!-- ===== ANALYTICS PAGE ===== -->
        <div id="analyticsPage" class="page">
            <div class="glass-card">
                <h3 style="color:white;margin-bottom:16px;">üìä Monthly Report</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 12px; color: #9CA3AF; margin-bottom: 4px;">Total Budget</div>
                        <div style="font-size: 22px; font-weight: 700; color: #1E90FF;" id="reportTotalBudget">‚Çπ0</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 12px; color: #9CA3AF; margin-bottom: 4px;">Spent This Month</div>
                        <div style="font-size: 22px; font-weight: 700; color: #EF4444;" id="reportMonthlySpent">‚Çπ0</div>
                    </div>
                </div>

                <div style="margin-bottom: 16px;">
                    <label class="form-label">View Category Trend</label>
                    <select class="form-select" id="categorySelect" onchange="updateCategoryReport()">
                        <option value="">Overall - All Categories</option>
                        <option value="food">üçî Food & Dining</option>
                        <option value="groceries">üõí Groceries</option>
                        <option value="transport">üöó Transport</option>
                        <option value="clothing">üëï Clothing</option>
                        <option value="debt">üí≥ Debt</option>
                        <option value="savings">üè¶ Savings</option>
                        <option value="shopping">üõçÔ∏è Shopping</option>
                        <option value="utilities">üí° Utilities</option>
                        <option value="health">üè• Health & Medical</option>
                        <option value="travel">‚úàÔ∏è Travel</option>
                        <option value="housing">üè† Housing</option>
                        <option value="entertainment">üé¨ Entertainment</option>
                        <option value="education">üìö Education</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                </div>

                <div style="height: 250px; margin-bottom: 16px;">
                    <canvas id="monthlyReportChart"></canvas>
                </div>
            </div>

            <div class="glass-card">
                <h3 style="color:white;margin-bottom:16px;">üìà Category Budget Breakdown</h3>
                <div id="categoryBudgetList"></div>
            </div>
        </div>

        <!-- ===== HISTORY PAGE ===== -->
        <div id="historyPage" class="page">
            <div class="glass-card">
                <h3 style="color:white;margin-bottom:14px;">üîç Search Transactions</h3>
                <div class="search-box" style="position: relative; margin-bottom: 12px;">
                    <input type="text" id="searchInput" placeholder="Search transactions..." onkeyup="updateHistory()">
                </div>
                
                <div style="display: flex; gap: 8px;">
                    <button class="btn-add" style="flex: 1; background: linear-gradient(135deg, #10B981, #059669);" onclick="exportDataPDF()">üì• Export PDF</button>
                    <button class="btn-add" style="flex: 1; background: linear-gradient(135deg, #6EA2B3, #4E8EA2);" onclick="exportDataCSV()">üìä Export CSV</button>
                </div>
            </div>
            <div id="historyList"></div>
        </div>

        <!-- ===== SETTINGS PAGE ===== -->
        <div id="settingsPage" class="page">
            <div class="glass-card">
                <h3 style="color:white;margin-bottom:16px;">Settings</h3>
                
                <div class="settings-item">
                    <div class="settings-item-left">
                        <h4>Light Mode</h4>
                        <p>Toggle between dark & light</p>
                    </div>
                    <button class="settings-toggle" id="themToggle" onclick="toggleTheme()"></button>
                </div>

                <div class="settings-item">
                    <div class="settings-item-left">
                        <h4>Notifications</h4>
                        <p>Toast alerts enabled</p>
                    </div>
                    <button class="settings-toggle on"></button>
                </div>

                <div class="settings-item">
                    <div class="settings-item-left">
                        <h4>Monthly Budget</h4>
                        <p id="settingsBudget" style="color: #10B981; font-weight: 600;">0</p>
                    </div>
                </div>

                <button class="btn-add" style="margin-top:20px;" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="switchPage('dashboard')">
            <span>üìä</span>
            <span class="nav-label">Dashboard</span>
        </button>
        <button class="nav-btn" onclick="switchPage('add')">
            <span>‚ûï</span>
            <span class="nav-label">Add</span>
        </button>
        <button class="nav-btn" onclick="switchPage('analytics')">
            <span>üìà</span>
            <span class="nav-label">Budget</span>
        </button>
        <button class="nav-btn" onclick="switchPage('history')">
            <span>üïê</span>
            <span class="nav-label">History</span>
        </button>
        <button class="nav-btn" onclick="switchPage('settings')">
            <span>‚öôÔ∏è</span>
            <span class="nav-label">Settings</span>
        </button>
    </div>
</div>

<script>
    // ===== STATE =====
    let isSignup = false;
    let isLoggedIn = false;
    let currentUser = null;
    let currentType = 'expense';
    let transactions = [];
    let monthlyBudget = 50000;

    let categoryBudgets = {
        food: 5000,
        groceries: 4000,
        transport: 3000,
        clothing: 2000,
        debt: 4000,
        savings: 5000,
        shopping: 3000,
        utilities: 2500,
        health: 2000,
        travel: 6000,
        housing: 8000,
        entertainment: 2500,
        education: 3000,
        other: 2000
    };

    const categoryEmojis = {
        // Expense Categories
        food: 'üçî',
        groceries: 'üõí',
        transport: 'üöó',
        clothing: 'üëï',
        debt: 'üí≥',
        savings: 'üè¶',
        shopping: 'üõçÔ∏è',
        utilities: 'üí°',
        health: 'üè•',
        travel: '‚úàÔ∏è',
        housing: 'üè†',
        entertainment: 'üé¨',
        education: 'üìö',
        other: 'üì¶',
        // Income Categories
        salary: 'üíº',
        freelance: 'üíª',
        investment: 'üìà',
        bonus: 'üéÅ',
        'other-income': 'üí∞'
    };

    // ===== CURRENCY DETECTION =====
    let currencySymbol = '‚Çπ'; // Default
    let currencyCode = 'INR';

    function detectCurrency() {
        try {
            const formatter = new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' });
            const parts = formatter.formatToParts(1);
            const currencyPart = parts.find(p => p.type === 'currency');
            if (currencyPart) {
                currencySymbol = currencyPart.value;
            }
        } catch (e) {
            // Fallback based on timezone
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (timezone.includes('Asia/Kolkata')) {
                currencySymbol = '‚Çπ';
                currencyCode = 'INR';
            } else if (timezone.includes('America') || timezone.includes('UTC')) {
                currencySymbol = '$';
                currencyCode = 'USD';
            } else if (timezone.includes('Europe')) {
                currencySymbol = '‚Ç¨';
                currencyCode = 'EUR';
            } else {
                currencySymbol = '‚Çπ'; // Default to INR
                currencyCode = 'INR';
            }
        }
    }

    // ===== AUTH =====
    function toggleAuthMode() {
        isSignup = !isSignup;
        const titleEl = document.getElementById('authTitle');
        const toggleEl = document.getElementById('toggleText');
        const confirmPwEl = document.getElementById('authConfirmPassword');
        
        if (isSignup) {
            titleEl.textContent = 'Sign Up';
            toggleEl.textContent = 'Already have account? ';
            confirmPwEl.classList.remove('hidden');
        } else {
            titleEl.textContent = 'Login';
            toggleEl.textContent = `Don't have account? `;
            confirmPwEl.classList.add('hidden');
        }
    }

    function handleAuth() {
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        
        if (!email || !password) {
            alert('Please fill all fields');
            return;
        }

        if (isSignup) {
            // Firebase Sign Up
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    isLoggedIn = true;
                    showNotification('‚úÖ Account created successfully!');
                    loadTransactionsFromFirebase();
                    document.getElementById('authScreen').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    updateDashboard();
                    updateBudgetDisplay();
                    setDefaultDate();
                })
                .catch((error) => {
                    alert('Sign up error: ' + error.message);
                });
        } else {
            // Firebase Login
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    isLoggedIn = true;
                    showNotification('‚úÖ Logged in successfully!');
                    loadTransactionsFromFirebase();
                    document.getElementById('authScreen').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    updateDashboard();
                    updateBudgetDisplay();
                    setDefaultDate();
                })
                .catch((error) => {
                    alert('Login error: ' + error.message);
                });
        }
    }

    function logout() {
        firebase.auth().signOut().then(() => {
            isLoggedIn = false;
            currentUser = null;
            transactions = [];
            
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
            document.getElementById('authEmail').value = '';
            document.getElementById('authPassword').value = '';
            document.getElementById('authConfirmPassword').value = '';
            showNotification('üëã Logged out successfully');
        }).catch((error) => {
            alert('Logout error: ' + error.message);
        });
    }

    // ===== NAVIGATION =====
    function switchPage(page) {
        // Hide all pages
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        
        // Show selected page
        document.getElementById(page + 'Page').classList.add('active');
        event.target.closest('.nav-btn').classList.add('active');
        
        if (page === 'history') updateHistory();
        if (page === 'analytics') updateAnalytics();
    }

    // ===== DASHBOARD =====
    function setDefaultDate() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('transDate').value = today;
        updateHeaderDate();
    }

    function updateHeaderDate() {
        const options = { weekday: 'short', month: 'short', day: 'numeric' };
        const date = new Date().toLocaleDateString('en-IN', options);
        document.getElementById('headerDate').textContent = date;
    }

    function updateDashboard() {
        const currentMonth = new Date().toISOString().substring(0, 7);
        
        let totalIncome = 0;
        let totalExpenses = 0;
        let monthlyExpenses = 0;

        transactions.forEach(t => {
            if (t.type === 'income') totalIncome += t.amount;
            else totalExpenses += t.amount;
            
            if (t.date.substring(0, 7) === currentMonth && t.type === 'expense') {
                monthlyExpenses += t.amount;
            }
        });

        const balance = totalIncome - totalExpenses;
        const budgetUsed = (monthlyExpenses / monthlyBudget) * 100;
        const budgetLeft = monthlyBudget - monthlyExpenses;

        document.getElementById('totalBalance').textContent = currencySymbol + balance.toLocaleString('en-IN');
        document.getElementById('totalIncome').textContent = currencySymbol + totalIncome.toLocaleString('en-IN');
        document.getElementById('monthlyExpense').textContent = currencySymbol + monthlyExpenses.toLocaleString('en-IN');
        document.getElementById('budgetLeft').textContent = currencySymbol + Math.max(budgetLeft, 0).toLocaleString('en-IN');
        document.getElementById('budgetPercent2').textContent = Math.round(budgetUsed) + '%';
        document.getElementById('budgetBar').style.width = Math.min(budgetUsed, 100) + '%';

        // Alert
        const alertEl = document.getElementById('alertText');
        if (budgetUsed > 80) {
            alertEl.textContent = '‚ö†Ô∏è You\'ve used 80% of your budget!';
        } else if (budgetUsed > 100) {
            alertEl.textContent = '‚ùå You\'ve exceeded your budget!';
        } else {
            alertEl.textContent = '‚úÖ You\'re spending well! Keep it up.';
        }

        renderRecentTransactions();
        drawCharts();
    }

    function renderRecentTransactions() {
        const recent = transactions.slice(-5).reverse();
        const html = recent.map(t => `
            <div class="transaction-item">
                <div class="transaction-left">
                    <div class="transaction-icon">${categoryEmojis[t.category] || 'üì¶'}</div>
                    <div class="transaction-info">
                        <h4>${t.category}</h4>
                        <p>${t.date}</p>
                    </div>
                </div>
                <div class="transaction-amount">
                    <div class="amount ${t.type === 'income' ? 'positive' : 'negative'}">
                        ${t.type === 'income' ? '+' : '-'}${currencySymbol}${t.amount.toLocaleString('en-IN')}
                    </div>
                </div>
            </div>
        `).join('');
        
        document.getElementById('recentTransactions').innerHTML = html || '<p style="color:#9CA3AF;">No transactions yet</p>';
    }

    // ===== ADD TRANSACTION =====
    function setType(type) {
        currentType = type;
        document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        updateCategoryOptions();
    }

    function updateCategoryOptions() {
        const categorySelect = document.getElementById('category');
        const options = categorySelect.querySelectorAll('optgroup');
        
        if (currentType === 'income') {
            // Hide expenses, show income
            options[0].style.display = 'none';
            options[1].style.display = 'block';
        } else {
            // Show expenses, hide income
            options[0].style.display = 'block';
            options[1].style.display = 'none';
        }
        categorySelect.value = '';
    }

    function addTransaction() {
        const amount = parseFloat(document.getElementById('amount').value);
        const category = document.getElementById('category').value;
        const date = document.getElementById('transDate').value;
        const note = document.getElementById('note').value;
        const tags = document.getElementById('tags').value;

        if (!amount || !category || !date) {
            alert('Please fill all required fields');
            return;
        }

        const newTransaction = {
            id: Date.now(),
            type: currentType,
            amount,
            category: category.toLowerCase(),
            date,
            note,
            tags: tags.split(',').map(t => t.trim()).filter(t => t),
            timestamp: new Date().toISOString()
        };

        transactions.push(newTransaction);

        // Save to Firebase
        if (isLoggedIn && currentUser) {
            const userId = currentUser.uid;
            firebase.database().ref('users/' + userId + '/transactions/' + newTransaction.id).set(newTransaction)
                .then(() => {
                    showNotification('‚úÖ Saved to cloud!');
                })
                .catch((error) => {
                    console.error('Save error:', error);
                    showNotification('‚ö†Ô∏è Saved locally only');
                });
        }

        resetAddForm();
        updateDashboard();
        renderLastTransactions();
    }

    function resetAddForm() {
        document.getElementById('amount').value = '';
        document.getElementById('note').value = '';
        document.getElementById('tags').value = '';
        document.getElementById('category').value = '';
        setDefaultDate();
    }

    function renderLastTransactions() {
        const last = transactions.slice(-5).reverse();
        const html = last.map(t => `
            <div class="transaction-item">
                <div class="transaction-left">
                    <div class="transaction-icon">${categoryEmojis[t.category] || 'üì¶'}</div>
                    <div class="transaction-info">
                        <h4>${t.category}</h4>
                        <p>${t.date} ${t.note ? '‚Ä¢ ' + t.note : ''}</p>
                    </div>
                </div>
                <div class="transaction-amount">
                    <div class="amount ${t.type === 'income' ? 'positive' : 'negative'}">
                        ${t.type === 'income' ? '+' : '-'}‚Çπ${t.amount.toLocaleString('en-IN')}
                    </div>
                </div>
            </div>
        `).join('');

        const totalAdded = transactions.filter(t => t.date === new Date().toISOString().split('T')[0]).reduce((sum, t) => sum + (t.type === 'expense' ? t.amount : 0), 0);
        document.getElementById('totalAddedToday').textContent = currencySymbol + totalAdded.toLocaleString('en-IN');
        document.getElementById('transactionCount').textContent = transactions.length;
        
        document.getElementById('lastTransactions').innerHTML = html || '<p style="color:#9CA3AF;">No transactions yet</p>';
    }

    // ===== HISTORY =====
    function updateHistory() {
        const search = document.getElementById('searchInput').value.toLowerCase();

        const filtered = transactions.filter(t => {
            const matchSearch = !search || t.category.includes(search) || t.note.toLowerCase().includes(search) || t.date.includes(search) || t.amount.toString().includes(search);
            return matchSearch;
        }).reverse();

        const html = filtered.map(t => `
            <div class="glass-card">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div style="display:flex;gap:12px;align-items:center;">
                        <div style="font-size:24px;">${categoryEmojis[t.category] || 'üì¶'}</div>
                        <div>
                            <div style="color:white;font-weight:600;">${t.category}${t.tags ? ' ‚Ä¢ ' + t.tags : ''}</div>
                            <div style="color:#9CA3AF;font-size:12px;">${t.date} ${t.note ? '‚Ä¢ ' + t.note : ''}</div>
                        </div>
                    </div>
                    <div style="text-align:right;color:${t.type === 'income' ? '#10B981' : '#EF4444'};font-weight:700;">
                        ${t.type === 'income' ? '+' : '-'}${currencySymbol}${t.amount.toLocaleString('en-IN')}
                    </div>
                </div>
            </div>
        `).join('');

        document.getElementById('historyList').innerHTML = html || '<div style="color:#9CA3AF;text-align:center;padding:20px;">No transactions found</div>';
    }

    // ===== ANALYTICS =====
    let monthlyReportChart;

    function updateAnalytics() {
        const currentMonth = new Date().toISOString().substring(0, 7);
        const expenseCategories = ['food', 'groceries', 'transport', 'clothing', 'debt', 'savings', 'shopping', 'utilities', 'health', 'travel', 'housing', 'entertainment', 'education', 'other'];
        
        // Calculate total spent this month
        let monthlySpent = 0;
        transactions.forEach(t => {
            if (t.type === 'expense' && t.date.substring(0, 7) === currentMonth) {
                monthlySpent += t.amount;
            }
        });

        document.getElementById('reportTotalBudget').textContent = currencySymbol + monthlyBudget.toLocaleString('en-IN');
        document.getElementById('reportMonthlySpent').textContent = currencySymbol + monthlySpent.toLocaleString('en-IN');

        // Draw monthly bar chart
        drawMonthlyReportChart();

        // Category breakdown
        const html = expenseCategories.map(cat => {
            const spent = transactions
                .filter(t => t.category === cat && t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const budget = 5000; // Sample per category
            const percent = (spent / budget) * 100;

            return `
                <div style="margin-bottom:16px;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                        <span style="color:white;font-weight:600;">${categoryEmojis[cat]} ${cat}</span>
                        <span style="color:#9CA3AF;">${currencySymbol}${spent.toLocaleString('en-IN')} / ${currencySymbol}${budget.toLocaleString('en-IN')}</span>
                    </div>
                    <div style="height:6px;background:rgba(255,255,255,0.1);border-radius:10px;overflow:hidden;">
                        <div style="height:100%;background:linear-gradient(90deg,#1E90FF,#0A4174);width:${Math.min(percent, 100)}%;transition:width 0.3s;"></div>
                    </div>
                </div>
            `;
        }).join('');

        document.getElementById('categoryBudgetList').innerHTML = html;
    }

    function updateCategoryReport() {
        drawMonthlyReportChart();
    }

    function drawMonthlyReportChart() {
        const selectedCategory = document.getElementById('categorySelect').value;
        const months = [];
        const monthlyData = [];
        
        // Get last 12 months data
        for (let i = 11; i >= 0; i--) {
            const date = new Date();
            date.setMonth(date.getMonth() - i);
            const monthKey = date.toISOString().substring(0, 7);
            const monthLabel = date.toLocaleDateString('en-IN', { month: 'short', year: '2-digit' });
            
            months.push(monthLabel);
            
            let monthTotal = 0;
            transactions.forEach(t => {
                if (t.type === 'expense' && t.date.substring(0, 7) === monthKey) {
                    if (selectedCategory === '' || t.category === selectedCategory) {
                        monthTotal += t.amount;
                    }
                }
            });
            monthlyData.push(monthTotal);
        }

        const chartLabel = selectedCategory === '' ? 'All Expenses' : categoryEmojis[selectedCategory] + ' ' + selectedCategory;

        if (monthlyReportChart) monthlyReportChart.destroy();
        const ctx = document.getElementById('monthlyReportChart').getContext('2d');
        monthlyReportChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: chartLabel,
                    data: monthlyData,
                    backgroundColor: [
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.6)',
                        'rgba(30, 144, 255, 0.8)',
                        'rgba(30, 144, 255, 1)'
                    ],
                    borderColor: '#1E90FF',
                    borderWidth: 2,
                    borderRadius: 6,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#9CA3AF' } }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#9CA3AF' },
                        grid: { color: 'rgba(255,255,255,0.05)' }
                    },
                    x: {
                        ticks: { color: '#9CA3AF' },
                        grid: { color: 'rgba(255,255,255,0.05)' }
                    }
                }
            }
        });
    }

    // ===== CHARTS =====
    let expenseChart, categoryChart;

    function drawCharts() {
        const currentMonth = new Date().toISOString().substring(0, 7);
        const monthData = {};
        const categoryData = {};

        transactions.forEach(t => {
            if (t.type === 'expense') {
                const day = t.date.split('-')[2];
                monthData[day] = (monthData[day] || 0) + t.amount;

                if (t.date.substring(0, 7) === currentMonth) {
                    categoryData[t.category] = (categoryData[t.category] || 0) + t.amount;
                }
            }
        });

        // Expense Chart
        if (expenseChart) expenseChart.destroy();
        const expenseCtx = document.getElementById('expenseChart').getContext('2d');
        expenseChart = new Chart(expenseCtx, {
            type: 'line',
            data: {
                labels: Object.keys(monthData).sort((a, b) => a - b),
                datasets: [{
                    label: 'Daily Expense',
                    data: Object.values(monthData),
                    borderColor: '#1E90FF',
                    backgroundColor: 'rgba(30, 144, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, ticks: { color: '#9CA3AF' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                    x: { ticks: { color: '#9CA3AF' }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
            }
        });

        // Category Chart
        if (categoryChart) categoryChart.destroy();
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        categoryChart = new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(categoryData).map(c => categoryEmojis[c] + ' ' + c),
                datasets: [{
                    data: Object.values(categoryData),
                    backgroundColor: ['#1E90FF', '#0A4174', '#6EA2B3', '#10B981', '#EF4444', '#F59E0B']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#9CA3AF' } } }
            }
        });
    }

    // ===== EXPORT FUNCTIONS =====
    function exportDataPDF() {
        let content = 'SPENDING TRACKER REPORT\n';
        content += '======================\n\n';
        content += `Generated: ${new Date().toLocaleDateString('en-IN')}\n\n`;

        const currentMonth = new Date().toISOString().substring(0, 7);
        let monthlyExpenses = 0;
        let totalIncome = 0;

        transactions.forEach(t => {
            if (t.type === 'income') totalIncome += t.amount;
            if (t.date.substring(0, 7) === currentMonth && t.type === 'expense') monthlyExpenses += t.amount;
        });

        content += `SUMMARY\n`;
        content += `-------\n`;
        content += `Total Income: ‚Çπ${totalIncome.toLocaleString('en-IN')}\n`;
        content += `Monthly Expenses: ‚Çπ${monthlyExpenses.toLocaleString('en-IN')}\n`;
        content += `Budget: ‚Çπ${monthlyBudget.toLocaleString('en-IN')}\n\n`;

        content += `ALL TRANSACTIONS\n`;
        content += `-----------------\n`;
        transactions.reverse().forEach(t => {
            content += `${t.date} | ${t.category.toUpperCase()} | ${t.type === 'income' ? '+' : '-'}‚Çπ${t.amount} | ${t.note}\n`;
        });

        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `spending_report_${new Date().toISOString().split('T')[0]}.txt`;
        link.click();
        URL.revokeObjectURL(url);
    }

    function exportDataCSV() {
        let csv = 'Date,Category,Type,Amount,Note,Tags\n';
        transactions.forEach(t => {
            const tags = Array.isArray(t.tags) ? t.tags.join(';') : '';
            csv += `${t.date},"${t.category}","${t.type}",${t.amount},"${t.note}","${tags}"\n`;
        });

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `spending_tracker_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        URL.revokeObjectURL(url);
    }

    function exportDataPDF() {
        let content = 'SPENDING TRACKER - TRANSACTION HISTORY\n';
        content += '======================================\n\n';
        content += `Generated: ${new Date().toLocaleDateString('en-IN')} ${new Date().toLocaleTimeString('en-IN')}\n`;
        content += `Total Budget: ${currencySymbol}${monthlyBudget.toLocaleString('en-IN')}\n\n`;

        content += 'TRANSACTIONS\n';
        content += '============\n\n';

        let totalIncome = 0;
        let totalExpense = 0;

        transactions.slice().reverse().forEach(t => {
            const type = t.type === 'income' ? 'INCOME' : 'EXPENSE';
            const sign = t.type === 'income' ? '+' : '-';
            content += `Date: ${t.date}\n`;
            content += `Category: ${t.category.toUpperCase()}\n`;
            content += `Type: ${type}\n`;
            content += `Amount: ${sign}${currencySymbol}${t.amount.toLocaleString('en-IN')}\n`;
            if (t.note) content += `Note: ${t.note}\n`;
            content += `\n`;

            if (t.type === 'income') totalIncome += t.amount;
            else totalExpense += t.amount;
        });

        content += '======================================\n';
        content += `SUMMARY\n`;
        content += `Total Income: ${currencySymbol}${totalIncome.toLocaleString('en-IN')}\n`;
        content += `Total Expense: ${currencySymbol}${totalExpense.toLocaleString('en-IN')}\n`;
        content += `Balance: ${currencySymbol}${(totalIncome - totalExpense).toLocaleString('en-IN')}\n`;

        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `spending_report_${new Date().toISOString().split('T')[0]}.pdf.txt`;
        link.click();
        URL.revokeObjectURL(url);
    }

    function exportDataCSV() {
        let csv = 'Date,Category,Type,Amount,Note\n';
        
        let totalIncome = 0;
        let totalExpense = 0;

        transactions.slice().reverse().forEach(t => {
            const note = t.note ? `"${t.note}"` : '';
            csv += `${t.date},"${t.category}","${t.type}",${t.amount},${note}\n`;
            
            if (t.type === 'income') totalIncome += t.amount;
            else totalExpense += t.amount;
        });

        csv += `\n,SUMMARY,\n`;
        csv += `,Total Income,${totalIncome}\n`;
        csv += `,Total Expense,${totalExpense}\n`;
        csv += `,Balance,${totalIncome - totalExpense}\n`;
        csv += `,Monthly Budget,${monthlyBudget}\n`;

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `spending_tracker_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        URL.revokeObjectURL(url);
    }

// ===== FIREBASE INIT (Script ‡§ï‡•á END ‡§Æ‡•á‡§Ç) =====
window.addEventListener('load', () => {
    console.log('App Loading...');

    const firebaseConfig = {
        apiKey: "AIzaSyCLnj8vRLLjgfWFlu9wU0gK8ZccmpA67GI",
        authDomain: "spendingtracker-a3e9a.firebaseapp.com",
        projectId: "spendingtracker-a3e9a",
        storageBucket: "spendingtracker-a3e9a.firebasestorage.app",
        messagingSenderId: "948139369692",
        databaseURL: "https://spendingtracker-a3e9a-default-rtdb.asia-southeast1.firebasedatabase.app/",
        appId: "1:948139369692:web:7df339d507716a22864019"
    };


        // Initialize Firebase - ‡§Ø‡§π MUST ‡§π‡•à!
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
        console.log('‚úÖ Firebase initialized');
    }
});

    // ===== LOAD FROM FIREBASE =====
    function loadTransactionsFromFirebase() {
        if (!isLoggedIn || !currentUser) {
            loadSampleData();
            return;
        }

        const userId = currentUser.uid;
        firebase.database().ref('users/' + userId + '/transactions').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                transactions = Object.values(data);
                updateDashboard();
                renderLastTransactions();
                updateHistory();
            } else {
                loadSampleData();
            }
        });
    }

    // ===== SAMPLE DATA =====
    function loadSampleData() {
        transactions = [
            { id: 1, type: 'income', amount: 50000, category: 'food', date: '2025-12-01', note: 'Salary', tags: ['salary', 'monthly'] },
            { id: 2, type: 'expense', amount: 500, category: 'food', date: '2025-12-02', note: 'Lunch', tags: ['food'] },
            { id: 3, type: 'expense', amount: 1200, category: 'transport', date: '2025-12-03', note: 'Uber', tags: ['work'] },
            { id: 4, type: 'expense', amount: 3000, category: 'shopping', date: '2025-12-04', note: 'Clothes', tags: ['recurring'] },
            { id: 5, type: 'expense', amount: 800, category: 'entertainment', date: '2025-12-05', note: 'Movie', tags: ['weekend'] }
        ];
    }

    // ===== TOAST NOTIFICATION SYSTEM =====
    function showNotification(message, type = 'success') {
        const toastContainer = document.getElementById('toastContainer') || createToastContainer();
        
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        const bgColor = {
            success: 'rgba(16, 185, 129, 0.95)',
            error: 'rgba(239, 68, 68, 0.95)',
            warning: 'rgba(245, 158, 11, 0.95)',
            info: 'rgba(30, 144, 255, 0.95)'
        }[type] || 'rgba(16, 185, 129, 0.95)';
        
        const icons = {
            success: '‚úÖ',
            error: '‚ùå',
            warning: '‚ö†Ô∏è',
            info: '‚ÑπÔ∏è'
        };
        
        toast.style.cssText = `
            background: ${bgColor};
            color: white;
            padding: 14px 18px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.3s ease, slideOutRight 0.3s ease 2.7s forwards;
            z-index: 9999;
            min-width: 250px;
        `;
        
        toast.innerHTML = `<span>${icons[type] || 'üì¢'}</span><span>${message}</span>`;
        toastContainer.appendChild(toast);
        
        setTimeout(() => toast.remove(), 3000);
    }

    function createToastContainer() {
        const container = document.createElement('div');
        container.id = 'toastContainer';
        container.style.cssText = `
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 8px;
        `;
        document.body.appendChild(container);
        return container;
    }

    // ===== UPDATE BUDGET DISPLAY =====
    function updateBudgetDisplay() {
        document.getElementById('settingsBudget').textContent = currencySymbol + monthlyBudget.toLocaleString('en-IN');
    }

    // ===== THEME MANAGEMENT =====
    function toggleTheme() {
        const isDark = document.body.classList.contains('light-mode');
        if (isDark) {
            document.body.classList.remove('light-mode');
            localStorage.setItem('theme', 'dark');
            document.getElementById('themToggle').classList.remove('on');
        } else {
            document.body.classList.add('light-mode');
            localStorage.setItem('theme', 'light');
            document.getElementById('themToggle').classList.add('on');
        }
        showNotification(isDark ? 'üåô Dark Mode activated' : '‚òÄÔ∏è Light Mode activated', 'info');
    }

    function loadTheme() {
        const theme = localStorage.getItem('theme') || 'dark';
        if (theme === 'light') {
            document.body.classList.add('light-mode');
            document.getElementById('themToggle').classList.add('on');
        }
    }

    // ===== INIT =====
    window.addEventListener('load', () => {
        detectCurrency();
        updateHeaderDate();
        loadTheme();
        createToastContainer();
        document.getElementById('transDate').valueAsDate = new Date();
        setType('expense');
        updateCategoryOptions();
        
        // Check Firebase Auth State
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                isLoggedIn = true;
                loadTransactionsFromFirebase();
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                updateDashboard();
                updateBudgetDisplay();
            }
        });
    });

    // Add animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
        
        .toast {
            transition: all 0.3s ease;
        }
    `;
    document.head.appendChild(style);
</script>
</script>

</body>
</html>
